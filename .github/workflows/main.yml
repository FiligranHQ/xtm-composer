name: build-latest

on:
  push:
    branches:
      - master
      - ci-masterpush-deploydev

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
#      - name: Login to Docker Hub
#        uses: docker/login-action@v3
#        with:
#          username: ${{ secrets.DOCKERHUB_USERNAME }}
#          password: ${{ secrets.DOCKERHUB_TOKEN }}
#
#      - name: Set up Docker Buildx
#        uses: docker/setup-buildx-action@v3
#
#      - name: Build and push
#        uses: docker/build-push-action@v6
#        with:
#          push: true
#          tags: filigran/${{ github.event.repository.name }}:latest

      - name: Setup kubectl
        uses: azure/setup-kubectl@v3

      - name: Redeploy on customer-dev
        run: |
          kubectl --server=https://api.staging.eu-west.filigran.io --token=${{ secrets.K8S_TOKEN_DEV }} -n customer-dev rollout restart deployment -l app=xtm-composer